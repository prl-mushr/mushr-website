---
title: "Autonomous_navigation"
date: 2021-06-15T15:06:09-07:00
summary: "Brief summary of your tutorial."
difficulty: "Beginner, Intermediate, or Advanced"
duration: 0
featured: false  # whether this is listed at / (must also be top 6 by weight). 
active: true     # whether this is listed at /tutorials/
draft: false      # whether Hugo considers this a draft
weight: 3        # 2 = intro tutorial 3 = anything else
---

<h2> By: <a href=https://mushr.io/>Your Name</a></h2>

<!-- Header figure required! -->
<br>
{{< figure src="/tutorials/first_steps/firststep.jpg" width="800" >}} <br>                           
<br>

### Introduction
Learn how to use a particle filter, global planner, and local controller to localize and autonomously navigate an environment.

### Goal
This tutorial will give you a baseline understanding of MuSHR's autonomous navigation stack and the algorithms involved. By the end of the tutorial, the car will be able to autonomously navigate around known obstacles on a known map.

### Requirements
List of previous tutorials, hardware requirements, or system requirements to complete this tutorial. Requirements from previous tutorials are implied and do not need to be restated.
* **requirement 1:** If in sim, complete the [quickstart tutorial](https://mushr.io/tutorials/quickstart/)
* **requirement 2:** If on real car, complete the [first steps tutorial](https://mushr.io/tutorials/first_steps/). It will also be helpful to use a map of your own environment. The [mapping tutorial](https://mushr.io/tutorials/mapping/) can walk you through how to create a map using the MuSHR car.

## How it works:

### Particle Filter
The particle filter works by taking in the laser scan and known map and using a probability function to determine the car's most likely position. At a high level, we determine how likely it is that a car is in a certain position on the map, based on the input from the LIDAR (laser scan). We continously update this postion. This aided by a kinematic motion model, which helps narrow down the probabilities further by the expected motion of the car from given controls. Since no mathematical model can be perfect due to many factors, the particle filter helps determine the postion and orientation of the car without relying entirely on a mathematical model. For further detail, refer to [these slides](https://courses.cs.washington.edu/courses/cse478/20wi/site/resources/lec8_particle_filter.pdf) from a University of Washington robotics class.

### Global Planner
The global planner uses a map of the environment, the robot's current (start) postion, and a goal to plan a good path from start to goal. The challenge of a good global planner is to be close to optimal (shortest and collision-free path) but also plan quickly enough such that the total (planning + driving) time is minimized. Our global planner uses the ARA* search algorithm on the map. This algorithm quickly finds any feasible solution, prioritizing potential paths that lead directly to the goal based on a heuristic, and then uses remaining allotted time to improve this solution. For further detail, refer to [these slides](https://courses.cs.washington.edu/courses/cse478/20wi/site/resources/lec19_heuristic.pdf) form a University of Washington robotics class and [this paper](http://www.cs.cmu.edu/~ggordon/mlikhach-ggordon-thrun.ara-tr.pdf) from Carnegie Mellon University.


### Local Controller
The local controller uses the path generated by the global planner and the car position estimated by the particle filter to decide the next optimal control for the car. The car cultivates a subset of possible trajectories that sparsely represent all possible trajectories. From these trajectories, we pick the trajectory which minimizes a cost based on collisions with obstacles on the map and closely matches the path provided by the global planner. For more information about controllers like the one used by the MuSHR car, check out Model Predicative Controllers (MPCs). [These slides,](https://courses.cs.washington.edu/courses/cse478/20wi/site/resources/lec16_ilqr_mpc.pdf) starting at slide 34 from a University of Washington robotics class have more detail.


## Installation
### On the sim
Finally, you will need the ```mushr_pf```, which is a particle filter.
{{< highlight bash >}}
$ cd ~/catkin_ws/src/
$ git clone https://github.com/prl-mushr/mushr_pf.git
{{< / highlight >}}

Follow the instructions in the [README](https://github.com/prl-mushr/mushr_pf) to complete installation of ```mushr_pf```.

Next, you'll need ```mushr_gp```, which is the global planner.
{{< highlight bash >}}
$ cd ~/catkin_ws/src/
$ git clone https://github.com/prl-mushr/mushr_gp.git
{{< / highlight >}}

Follow the instructions in the [README](https://github.com/prl-mushr/mushr_gp) to complete installation of ```mushr_gp```.

In order to make ```mushr_gp``` work, you will also need ```pysbpl```.
{{< highlight bash >}}
$ cd ~/catkin_ws/src/
$ git clone https://github.com/schmittlema/pysbpl.git
{{< / highlight >}}

Follow the INSTALL instructions in the [pysbpl README](https://github.com/schmittlema/pysbpl). Please use the "for development" build command.

The first repo we'll need is ```mushr_rhc```, which is the local controller.
{{< highlight bash >}}
$ cd ~/catkin_ws/src/
$ git clone https://github.com/prl-mushr/mushr_rhc.git 
{{< / highlight >}}

Follow the instructions in the [README](https://github.com/prl-mushr/mushr_rhc) to complete installation of ```mushr_rhc```.

## Running the autonomous navigation stack
### On the sim
Open a terminal, and run the following command to start the mushr stack and load the map. Remember to change the map if you would like to test on a different map.
{{< highlight bash >}}
$ roslaunch mushr_sim teleop.launch 
{{< / highlight >}}

OPTIONAL: Open a new terminal, and start the particle filter. Note that this step is optional in the sim, because the sim publishes the exact position of the car (no need to localize).
{{< highlight bash >}}
$ roslaunch mushr_pf sim.launch
{{< / highlight >}}

Open a new terminal, and start the global planner.
{{< highlight bash >}}
$ roslaunch mushr_gp planner.launch 
{{< / highlight >}}

Open a new terminal, and start the local controller.
{{< highlight bash >}}
$ roslaunch mushr_rhc sim.launch 
{{< / highlight >}}

Finally, in another terminal, launch rviz.
{{< highlight bash >}}
$ rviz 
{{< / highlight >}}

## Troubleshooting
When people make edits to your tutorial later, it is good to have this section for them to add some tips to challenges they may face.

* **the joystick isn't working:** Turn on the joystick then try again...
* **the computer won't start:** Check to make sure it is getting power, if not reflash. 
